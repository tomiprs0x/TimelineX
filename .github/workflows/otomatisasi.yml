name: OtomatisSasi

on:
  push:
    branches:
      - main
      
  schedule:
    - cron: '0 7,0,11,18 * * *'
  
  # Add manual workflow dispatch
  workflow_dispatch:
    inputs:
      commit_reason:
        description: 'Reason for manual dispatch'
        required: false
        default: 'Manual test run'

jobs:
  auto_commit:
    runs-on: ubuntu-latest
    steps:
      - name: Global directory configuration
        run: |
          git config --global --add safe.directory /github/workspace
          
      - uses: actions/checkout@v3 
        with:
          persist-credentials: False
          fetch-depth: 1
          
      - name: Generate meaningful changes
        run: |
          d=`date '+%Y-%m-%dT%H:%M:%SZ'`
          echo $d > LAST_UPDATED
          
          # Add random content to make commits look more natural
          echo "Manual dispatch run at $d" >> README.md
          
          # Log the dispatch reason if provided
          echo "Dispatch Reason: ${{ github.event.inputs.commit_reason }}" >> dispatch_log.txt
          
      - name: Commit changes
        run: |
          git config --local user.email "69198533+justTheKai@users.noreply.github.com"
          git config --local user.name "JustThekai"
          
          # More sophisticated commit message array
          declare -a commit_messages=(
            "chore: ğŸ”„ Routine system update"
            "docs: ğŸ“ Update project documentation"
            "fix: ğŸ› Minor system maintenance"
            "perf: âš¡ Optimize workflow processes"
            "refactor: ğŸ› ï¸ Improve code structure"
            "build: ğŸ—ï¸ Update dependency management"
            "ci: ğŸ”§ Enhance continuous integration"
            "test: ğŸ§ª Add monitoring checkpoints"
          )
          
          # Randomize commit message selection
          rand=$((RANDOM % ${#commit_messages[@]}))
          selected_message="${commit_messages[$rand]}"
          
          git add -A
          git commit -m "$selected_message"
          
      - name: GitHub Push
        uses: ad-m/github-push-action@v0.6.0
        with:
          force: true
          directory: "."
          github_token: ${{ secrets.GITHUB_TOKEN }}
